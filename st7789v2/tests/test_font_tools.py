from st7789v2.lib.font_tools import (
    assemble_string,
    bytes_to_bits,
    colour_bits,
    flatten,
    scale_bits,
)


def test_bytes_to_bits():
    """Test it makes lists of bits."""
    byte_list = [0, 66, 66, 126, 66, 66, 66, 0]
    assert bytes_to_bits(byte_list) == [
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 1, 1, 1, 1, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
    ]


def test_scale_bits():
    """Test it scales the bits."""
    bits = [
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 1, 1, 1, 1, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 1, 0, 0, 0, 0, 1, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
    ]
    assert scale_bits(bits, 2) == [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    ]


def test_colour_bits():
    """Test it applies colour to the bits."""
    bits = [
        [0, 0, 0, 0],
        [0, 1, 0, 0],
        [0, 1, 1, 1],
        [0, 1, 0, 0],
    ]

    assert list(colour_bits(bits, 4, 0)) == [
        [0, 0, 0, 0],
        [0, 4, 0, 0],
        [0, 4, 4, 4],
        [0, 4, 0, 0],
    ]

    assert list(colour_bits(bits, (127, 255), (0, 63))) == [
        [0, 63, 0, 63, 0, 63, 0, 63],
        [0, 63, 127, 255, 0, 63, 0, 63],
        [0, 63, 127, 255, 127, 255, 127, 255],
        [0, 63, 127, 255, 0, 63, 0, 63],
    ]


def test_assemble_string():
    """Test it adds characters together."""
    left = [
        [0, 1, 1, 0],
        [0, 1, 1, 1],
        [0, 0, 1, 0],
        [0, 0, 0, 0],
    ]
    right = [
        [0, 0, 0, 1],
        [1, 0, 0, 1],
        [0, 0, 1, 1],
        [1, 1, 1, 1],
    ]

    assert assemble_string(left, right) == [
        [0, 1, 1, 0, 0, 0, 0, 1],
        [0, 1, 1, 1, 1, 0, 0, 1],
        [0, 0, 1, 0, 0, 0, 1, 1],
        [0, 0, 0, 0, 1, 1, 1, 1],
    ]


def test_flattener():
    """Test it flattens."""
    bits = [
        [0, 1, 1, 0],
        [0, 1, 1, 1],
        [0, 0, 1, 0],
        [0, 0, 0, 0],
    ]

    assert list(flatten(bits)) == [
        (0, 1),
        (1, 1),
        (1, 0),
        (0, 0),
        (0, 1),
        (1, 1),
        (1, 1),
        (1, 0),
        (0, 0),
        (0, 1),
        (1, 0),
        (0, 0),
        (0, 0),
        (0, 0),
        (0, 0),
    ]
